<!DOCTYPE html>
<html>
<head>
<title>SealLaw Results</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="navbar">
  <div class="logo" onclick="location.href='index.html'">SealLaw</div>
</nav>

<div class="results-container">

<h2>Search Results</h2>
<div id="filters"></div>
<div id="results"></div>
<div id="pagination"></div>
<div id="logs"></div>

</div>

<script src="data.js"></script>
<script>

const query = localStorage.getItem("sealaw_query") || "";
const startTime = performance.now();

function tokenize(q){
  return q.toLowerCase().split(/\s+/).filter(x=>x.length>2);
}

function scoreCase(c, tokens){
  let score=0;
  tokens.forEach(t=>{
    if(c.title.toLowerCase().includes(t)) score+=5;
    if(c.law.join(" ").toLowerCase().includes(t)) score+=3;
    if(c.summary.toLowerCase().includes(t)) score+=1;
  });
  return score;
}

function search(){
  const tokens = tokenize(query);
  const scored = cases.map(c=>({
    case:c,
    score:scoreCase(c,tokens)
  })).filter(x=>x.score>0)
    .sort((a,b)=>b.score-a.score);

  render(scored);
  renderLogs(tokens, scored);
}

function render(results){
  const container=document.getElementById("results");
  container.innerHTML="";
  results.slice(0,5).forEach(r=>{
    const c=r.case;
    container.innerHTML+=`
      <div class="card">
        <h3>${c.title}</h3>
        <p>${c.summary.substring(0,150)}...</p>
        <button onclick="preview('${c.id}')">View</button>
      </div>`;
  });
}

function preview(id){
  const c=cases.find(x=>x.id==id);
  alert(c.title + "\n\n" + c.summary);
}

function renderLogs(tokens, results){
  const end=performance.now();
  document.getElementById("logs").innerHTML=`
  <h3>Search Engine Logs</h3>
  Tokens: ${tokens.join(", ")}<br>
  Matches: ${results.length}<br>
  Query Time: ${(end-startTime).toFixed(2)} ms
  `;
}

search();
</script>

</body>
</html>
